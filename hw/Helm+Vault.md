# 2\. Разработка Helm-чарта.

# Часть 1\.

Создаем helm-чарт

## Что нужно сделать

* Установить Helm  
* Создать свой helm-чарт  
* На основе values и манифестов из первого задания написать helm-шаблоны  
* Вынести все переиспользуемые настройки в values.yaml  
* Отрефакторить helm-чарт в соответствии с [best practices](https://helm.sh/docs/chart_best_practices/conventions/)  
* Вынести зависимые компоненты в [subcharts](https://helm.sh/docs/chart_template_guide/subcharts_and_globals/)  
* Проверить правильность написания шаблонов и настроек  
  * helm install –dry-run  
* Сделать релиз helm-чарта

# Часть 2\.

Настраиваем секреты

## Что нужно сделать

* Установить helm-secrets  
* Развернуть vault  
  * Образ [vault из ArtifactHub](https://artifacthub.io/packages/helm/hashicorp/vault)  
  * Если есть проблемы с 403 ошибкой \- взять vault из зеркала  
* Настроить чарт vault  
  * Настроить ingress  
  * Настроить API  
  * Включить web-интерфейс  
  * При желании  
    * Настроить сертификаты  
    * Настроить HA  
* Настроить vault  
  * Сделать init и unseal  
  * Сделать движок секретов  
  * Сделать политику доступа к секретам  
  * Включить AppRole аутентификацию  
  * Создать роль  
* Настроить интеграцию vals с vault  
  * Сделать env  
  * Сделать env-example  
  * Сделать скрипт деплоя чартов при помощи helm-secrets  
* Заменить чувствительные данные в yaml-файлах на ref\`ы с путями vault  
  * При желании  
    * Отрефакторить чарты так, чтобы чарты не создавали secrets (кроме tls)

